<div class="accordion accordion-flush mb-2" id="accordionFlushExample">
  <div class="accordion-item rounded-top-m rounded-bottom-xs">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed fs-11 text-primary-700 fw-medium pt-4" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
        日常生活
      </button>
    </h2>
    <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
      <div class="accordion-body py-0">
        <!-- ★ 改 textarea；加 data-section 與類名 -->
        <textarea
          class="form-control rounded-3 text-primary-700 diary-textarea"
          data-section="daily"
          placeholder="請輸入文字"></textarea>
        <!-- ★ 儲存後會把文字插在這裡 -->
        <div class="saved-list mt-2"></div>
      </div>
    </div>
  </div>
  <div class="accordion-item rounded-top-m rounded-bottom-xs">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed fs-11 text-primary-700 fw-medium pt-4" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
        感謝的事
      </button>
    </h2>
    <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
      <div class="accordion-body py-0">
        <!-- ★ 改 textarea；加 data-section 與類名 -->
        <textarea
          class="form-control rounded-3 text-primary-700 diary-textarea"
          data-section="daily"
          placeholder="請輸入文字"></textarea>
        <!-- ★ 儲存後會把文字插在這裡 -->
        <div class="saved-list mt-2"></div> 
      </div>
    </div>
  </div>
  <div class="accordion-item rounded-top-m rounded-bottom-xs">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed fs-11 text-primary-700 fw-medium pt-4" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
        其他
      </button>
    </h2>
    <div id="flush-collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
      <div class="accordion-body py-0"> 
        <!-- ★ 改 textarea；加 data-section 與類名 -->
        <textarea
          class="form-control rounded-3 text-primary-700 diary-textarea"
          data-section="daily"
          placeholder="請輸入文字"></textarea>
        <!-- ★ 儲存後會把文字插在這裡 -->
        <div class="saved-list mt-2"></div>                 
      </div>
    </div>
  </div>
</div>


<script>
/* ★ 日記：點任一卡片後，全數展開/收合；按「儲存」把內容塞回 HTML */
(function(){
  const $  = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

  const accRoot = document.getElementById('accordionFlushExample');
  if (!accRoot) return;

  // 建立所有 collapse 實例（不自動 toggle）
  const instances = $$('#accordionFlushExample .accordion-collapse')
    .map(el => window.bootstrap?.Collapse.getOrCreateInstance(el, { toggle: false }));

  function setAll(open){
    instances.forEach(inst => open ? inst.show() : inst.hide());
    accRoot.classList.toggle('acc-open', open); // ★ 展開態 class，給 SCSS 用
  }

  function syncFlag(){
    const allShown = $$('#accordionFlushExample .accordion-collapse')
      .every(el => el.classList.contains('show'));
    accRoot.classList.toggle('acc-open', allShown);
  }

  // ★ 點任一 header：群組切換（阻止單一折疊預設行為）
  accRoot.addEventListener('click', (e) => {
    const btn = e.target.closest('.accordion-button');
    if (!btn) return;
    e.preventDefault();
    e.stopPropagation();
    const allShown = $$('#accordionFlushExample .accordion-collapse')
      .every(el => el.classList.contains('show'));
    setAll(!allShown);
  });

  // 保險：同步旗標
  accRoot.addEventListener('shown.bs.collapse', syncFlag);
  accRoot.addEventListener('hidden.bs.collapse', syncFlag);

  // ★ 保留你的儲存功能
  const saveBtn = document.getElementById('saveDiaryBtn');
  if (saveBtn) {
    saveBtn.addEventListener('click', () => {
      const areas = $$('#accordionFlushExample .diary-textarea');
      areas.forEach(area => {
        const text = area.value.trim();
        if (!text) return;
        const body = area.closest('.accordion-body');
        const list = $('.saved-list', body);
        if (!list) return;

        const entry = document.createElement('div');
        entry.className = 'diary-entry';
        entry.textContent = text; // CSS 用 pre-wrap 保留換行
        list.appendChild(entry);

        // 若要存檔後清空輸入 → 打開下一行
        // area.value = '';
      });

      // 抽屜內容變高時，讓量測重算
      window.dispatchEvent(new Event('resize'));
    });
  }
})();
</script>